<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Оборудование НМК</title>
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    .container {
      max-width: 1200px;
      width: 100%;
      box-shadow: 0 0 10px rgba(0,0,0,.1);
      background-color: white;
      padding: 20px;
      border-radius: 10px;
    }

    h2 {
      color: #226e93;
      text-align: center;
      font-size: 2em;
      margin-bottom: 20px;
    }

    label {
      display: inline-block;
      margin-right: 10px;
      vertical-align: middle;
    }

    select, input[type="text"] {
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ddd;
      outline: none;
      transition: border-color .3s ease-in-out;
      margin-right: 10px;
    }

    select:focus, input[type="text"]:focus {
      border-color: #226e93;
    }

    button {
      padding: 10px 20px;
      background-color: #226e93;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color .3s ease-in-out;
    }

    button:hover {
      background-color: #1b5d7c;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      overflow-x: auto;
    }

    thead {
      background-color: #1b5d7c; /* Новый цвет заголовков таблицы */
      color: white;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
    }

    th.sorted-asc::after {
      content: " ▲";
      color: white;
    }

    th.sorted-desc::after {
      content: " ▼";
      color: white;
    }

    tbody tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    @media screen and (max-width: 768px) {
      table {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Оборудование НМК</h2>

  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
    <div style="display:flex;align-items:center;">
      <label for="statusFilter">Статус:</label>
      <select id="statusFilter">
        <option value="Все">Все</option>
        <option value="Занято">Занято</option>
        <option value="Свободно">Свободно</option>
      </select>

      <label for="typeFilter" style="margin-left:20px;">Тип оборудования:</label>
      <select id="typeFilter">
        <option value="Все">Все</option>
      </select>

      <label for="searchText" style="margin-left:20px;">Поиск по всем колонкам:</label>
      <input type="text" id="searchText" placeholder="Введите текст..."/>
    </div>

    <button id="clearFiltersBtn">Убрать фильтры</button>
    
    <!-- Кнопка для перехода на указанную страницу -->
    <a href="#" onclick="openLocalFile();return false;" style="margin-left: 10px;"><button>Открыть тестовую страницу</button></a>
  </div>

  <table id="equipTable">
    <thead>
      <tr>
        <th data-col="0">Тип</th>
        <th data-col="1">Описание</th>
        <th data-col="2">Стоимость</th>
        <th data-col="3">Кол-во</th>
        <th data-col="4">В работе</th>
        <th data-col="5">Занято по иным причинам</th>
        <th data-col="6">Свободно</th>
        <th data-col="7">Статус</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Скрипт для открытия локального файла -->
<script>
function openLocalFile() {
  alert('Данный браузер не поддерживает открытие файлов напрямую. Попробуйте скопировать путь вручную.');
  navigator.clipboard.writeText('C:\\Users\\isimonov\\Desktop\\сайт\\код\\test_index.html');
}

const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRR3bKUFvSQgLei3Zi4bzfuxZBw500l1-AEOnYc0s-Gka7Ca_IkKjMllqM9rzj6Q7ZR_ilxDVE2597n/pub?output=csv";

let allData = [];
// Нужные колонки: A,B,D,E,F,G,H,I
const neededCols = [0,1,3,4,5,6,7,8];
let sortConfig = { col: null, dir: 1 };

Papa.parse(url, {
  download: true,
  header: false,
  complete: function(results) {
    allData = results.data.slice(1);
    fillTypeFilter();
    renderTable("Все","Все","");
  }
});

function fillTypeFilter() {
  const typeSet = new Set();
  allData.forEach(row => {
    if (row[0]) typeSet.add(row[0].trim());
  });
  const select = document.getElementById("typeFilter");
  typeSet.forEach(type => {
    const opt = document.createElement("option");
    opt.value = type;
    opt.textContent = type;
    select.appendChild(opt);
  });
}

function renderTable(statusFilter, typeFilter, searchText) {
  const tbody = document.querySelector("#equipTable tbody");
  tbody.innerHTML = "";
  const search = searchText.toLowerCase();

  let filtered = allData.filter(row => {
    const status = row[7]?.trim();
    const type   = row[0]?.trim();
    const rowText = neededCols.map(idx => row[idx] ? row[idx].toString().toLowerCase() : "").join(" ");
    const matchSearch = search === "" || rowText.includes(search);

    return (statusFilter === "Все" || status === statusFilter) &&
           (typeFilter === "Все" || type === typeFilter) &&
           matchSearch;
  });

  // Сортируем таблицу
  if (sortConfig.col !== null) {
    filtered.sort((a,b) => {
      let valA = a[neededCols[sortConfig.col]] ?? "";
      let valB = b[neededCols[sortConfig.col]] ?? "";

      let numA = parseFloat(valA.toString().replace(",","."));
      let numB = parseFloat(valB.toString().replace(",","."));
      if (!isNaN(numA) && !isNaN(numB)) {
        return (numA - numB) * sortConfig.dir;
      }
      return valA.toString().localeCompare(valB.toString()) * sortConfig.dir;
    });
  }

  filtered.forEach(row => {
    const tr = document.createElement("tr");
    neededCols.forEach(idx => {
      const td = document.createElement("td");
      td.textContent = row[idx] ?? "";
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  document.querySelectorAll("#equipTable th").forEach((th,i) => {
    th.classList.remove("sorted-asc","sorted-desc");
    if (i === sortConfig.col) {
      th.classList.add(sortConfig.dir === 1 ? "sorted-asc" : "sorted-desc");
    }
  });
}

function clearFilters() {
  document.getElementById("statusFilter").value = "Все";
  document.getElementById("typeFilter").value = "Все";
  document.getElementById("searchText").value = "";
  sortConfig = { col: null, dir: 1 }; // Сброс конфигурации сортировки
  renderTable("Все", "Все", "");
}

function applyFilters() {
  renderTable(
    document.getElementById("statusFilter").value,
    document.getElementById("typeFilter").value,
    document.getElementById("searchText").value
  );
}

document.getElementById("statusFilter").addEventListener("change", applyFilters);
document.getElementById("typeFilter").addEventListener("change", applyFilters);
document.getElementById("searchText").addEventListener("input", applyFilters);

document.querySelectorAll("#equipTable th").forEach((th,i) => {
  th.addEventListener("click", () => {
    if (sortConfig.col === i) {
      sortConfig.dir *= -1;
    } else {
      sortConfig.col = i;
      sortConfig.dir = 1;
    }
    applyFilters();
  });
});

// Добавляем событие для кнопки "Убрать фильтры"
document.getElementById("clearFiltersBtn").addEventListener("click", clearFilters);
</script>
</body>
</html>
