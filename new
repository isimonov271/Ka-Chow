<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Фильтрация оборудования</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>Выбор оборудования</h1>
    <label for="status">Выберите статус:</label>
    <select id="statusFilter">
        <option value="">Все</option>
        <option value="Свободно">Свободно</option>
        <option value="Занято">Занято</option>
    </select>
    <button onclick="filterData()">Показать</button>
    <table id="equipmentTable"></table>

    <!-- Скрипт подключения и инициализации -->
    <script type="text/javascript">
        function initClient() {
            gapi.client.init({
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
                clientId: '342661927883-rrg5vb5240i88o1mgnfrknuasuud9kdu.apps.googleusercontent.com',
                scope: 'https://www.googleapis.com/auth/spreadsheets.readonly'
            }).then(function () {
                loadSheet();
            });
        };

        function loadSheet() {
            var spreadsheetId = '1xfDemOCc2rR7Caze4yZGNKqYpnhOVyrhwoPUVaBet4g'; // Ваш идентификатор таблицы
            var range = 'A:I';

            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: spreadsheetId,
                range: range
            }).then(function(response) {
                var rows = response.result.values;
                if (!rows || !rows.length) {
                    console.log('Нет данных');
                } else {
                    renderTable(rows);
                }
            }, function(response) {
                console.error('Ошибка:', response.result.error.message);
            });
        };

        function filterData() {
            const selectedStatus = document.querySelector('#statusFilter').value;
            const rows = [...document.querySelectorAll('#equipmentTable tbody tr')];
            rows.forEach(row => {
                const statusCell = row.cells[row.cells.length - 1].innerText.trim(); // Статус находится в последней ячейке строки
                if (selectedStatus === '' || statusCell === selectedStatus) {
                    row.style.display = ''; // Показываем строки, соответствующие фильтру
                } else {
                    row.style.display = 'none'; // Скрываем остальные строки
                }
            });
        };

        window.onload = function() {
            gapi.load('client', initClient); // Загрузка библиотеки Google Client API
        };

        function renderTable(data) {
            let tableHTML = '<thead><tr>';
            data[0].forEach(header => {
                tableHTML += `<th>${header}</th>`; // Первая строка - заголовки столбцов
            });
            tableHTML += '</tr></thead><tbody>';

            for (let i = 1; i < data.length; i++) { // Пропускаем первую строку (заголовки)
                tableHTML += '<tr>';
                data[i].forEach(cell => {
                    tableHTML += `<td>${cell}</td>`;
                });
                tableHTML += '</tr>';
            }
            tableHTML += '</tbody>';
            document.querySelector('#equipmentTable').innerHTML = tableHTML;
        };
    </script>
</body>
</html>
